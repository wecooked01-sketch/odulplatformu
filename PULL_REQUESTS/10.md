# Summary

CI, Prisma client export ve typing kaynaklı TS2305/TS2345 hatalarıyla kırılıyordu. lib/prisma.ts artık her ortamda named export `prisma` sağlıyor; gerçek Prisma varsa onu kullanıyor, yoksa PrismaPromise benzeri mock’a düşüyor; dev’de global cache ile tekil instance korunuyor.

# Errors observed in CI
- TS2305: Module "@/lib/prisma" has no exported member 'prisma'.
- TS2345: Argument of type 'MockPrismaClient' is not assignable to parameter of type 'PrismaClient<...>'.

# What changed
- lib/prisma.ts tamamen yenilendi.
- Her zaman named export `prisma` garanti edildi.
- @prisma/client yoksa CI’de typecheck’i bozmayacak esnek bir mock kullanıldı (PrismaPromise şekli taklit edildi).
- Geliştirmede HMR sırasında çoklu instance oluşmasını engellemek için caching eklendi.

# How to validate
- pnpm i && pnpm typecheck
- pnpm build
- Özellikle app/api/*/route.ts ve lib/auth/config.ts derlenmeli; TS2305/TS2345 görülmemeli.

# No runtime change
- @prisma/client mevcutsa davranış değişikliği yok.

# Follow-ups
- CI’da `prisma generate` güvenilir hale gelince `prisma` tipini `PrismaClient`’a sıkılaştırıp `any` genişlemesini kaldıracağız.
- schema ve DATABASE_URL hazır olduğunda `prisma generate`’i CI adımı olarak ekleyebiliriz.